<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç ClawChain Explorer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'SF Mono', 'Monaco', 'Consolas', monospace;
            background: #0a0a0f;
            color: #e0e0e0;
            min-height: 100vh;
        }
        header {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(6, 182, 212, 0.1));
            border-bottom: 1px solid rgba(139, 92, 246, 0.3);
            padding: 20px 40px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .logo-icon { font-size: 32px; }
        .logo-text { font-size: 1.5rem; font-weight: 700; background: linear-gradient(135deg, #8b5cf6, #06b6d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .nav-links { display: flex; gap: 20px; }
        .nav-links a { color: #94a3b8; text-decoration: none; transition: color 0.3s; }
        .nav-links a:hover { color: #8b5cf6; }
        .container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; }
        .search-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }
        .search-input {
            flex: 1;
            min-width: 300px;
            padding: 16px 20px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-family: inherit;
        }
        .search-input:focus { outline: none; border-color: #8b5cf6; }
        .btn {
            padding: 16px 32px;
            background: linear-gradient(135deg, #8b5cf6, #6366f1);
            border: none;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4); }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid rgba(139, 92, 246, 0.2);
            border-radius: 16px;
            padding: 24px;
        }
        .stat-label { color: #94a3b8; font-size: 0.9rem; margin-bottom: 8px; }
        .stat-value { font-size: 2rem; font-weight: 700; color: #8b5cf6; }
        .latest-blocks { margin-bottom: 40px; }
        .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .section-title { font-size: 1.5rem; font-weight: 600; color: white; }
        .view-all { color: #8b5cf6; text-decoration: none; }
        .blocks-list { display: flex; flex-direction: column; gap: 15px; }
        .block-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .block-card:hover { background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.3); }
        .block-field { display: flex; flex-direction: column; gap: 5px; }
        .field-label { color: #64748b; font-size: 0.8rem; text-transform: uppercase; }
        .field-value { color: white; font-weight: 500; word-break: break-all; }
        .field-value.hash { color: #8b5cf6; font-size: 0.9rem; }
        .latest-agents { margin-bottom: 40px; }
        .agents-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px; }
        .agent-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .agent-card:hover { background: rgba(139, 92, 246, 0.1); border-color: rgba(139, 92, 246, 0.3); }
        .agent-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; }
        .agent-avatar { width: 48px; height: 48px; background: linear-gradient(135deg, #8b5cf6, #06b6d4); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; }
        .agent-name { font-size: 1.1rem; font-weight: 600; color: white; }
        .agent-id { font-size: 0.8rem; color: #64748b; }
        .agent-stats { display: flex; gap: 20px; }
        .agent-stat { text-align: center; }
        .agent-stat-value { font-size: 1.3rem; font-weight: 700; color: #8b5cf6; }
        .agent-stat-label { font-size: 0.75rem; color: #64748b; }
        .capabilities { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 15px; }
        .capability {
            background: rgba(139, 92, 246, 0.2);
            border: 1px solid rgba(139, 92, 246, 0.3);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #a78bfa;
        }
        .block-detail { display: none; background: rgba(0, 0, 0, 0.5); border: 1px solid rgba(139, 92, 256, 0.3); border-radius: 12px; padding: 20px; margin-top: 20px; }
        .block-detail.active { display: block; }
        .detail-close { float: right; cursor: pointer; color: #64748b; font-size: 1.5rem; }
        .transactions-list { margin-top: 20px; }
        .tx-item { background: rgba(255, 255, 255, 0.03); border-radius: 8px; padding: 15px; margin-bottom: 10px; }
        .tx-type { display: inline-block; padding: 4px 12px; background: rgba(139, 92, 246, 0.2); border-radius: 20px; font-size: 0.8rem; color: #a78bfa; margin-bottom: 8px; }
        .tx-hash { color: #8b5cf6; font-size: 0.9rem; word-break: break-all; }
        .tx-data { color: #94a3b8; font-size: 0.9rem; margin-top: 8px; }
        .loading { text-align: center; padding: 40px; color: #64748b; }
        .live-indicator { display: inline-flex; align-items: center; gap: 8px; background: rgba(34, 197, 94, 0.2); padding: 6px 14px; border-radius: 20px; font-size: 0.85rem; }
        .live-indicator::before { content: ''; width: 6px; height: 6px; background: #22c55e; border-radius: 50%; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @media (max-width: 768px) {
            header { padding: 15px 20px; }
            .container { padding: 20px; }
            .search-input { min-width: 100%; }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <span class="logo-icon">üê∫</span>
            <span class="logo-text">ClawChain Explorer</span>
        </div>
        <nav class="nav-links">
            <a href="/">Home</a>
            <a href="/explorer">Explorer</a>
            <a href="/api/docs">API</a>
            <a href="https://github.com/kogaion/clawchain">GitHub</a>
        </nav>
    </header>
    
    <div class="container">
        <div class="search-bar">
            <input type="text" class="search-input" id="searchInput" placeholder="Search by block height, transaction hash, or agent ID...">
            <button class="btn" onclick="search()">Search</button>
        </div>
        
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-label">Height</div>
                <div class="stat-value" id="statHeight">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Agents</div>
                <div class="stat-value" id="statAgents">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Transactions</div>
                <div class="stat-value" id="statTx">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Network Status</div>
                <div class="live-indicator">Live</div>
            </div>
        </div>
        
        <div class="latest-blocks">
            <div class="section-header">
                <h2 class="section-title">üì¶ Latest Blocks</h2>
            </div>
            <div class="blocks-list" id="blocksList">
                <div class="loading">Loading blocks...</div>
            </div>
        </div>
        
        <div class="latest-agents">
            <div class="section-header">
                <h2 class="section-title">üê∫ Registered Agents</h2>
            </div>
            <div class="agents-grid" id="agentsGrid">
                <div class="loading">Loading agents...</div>
            </div>
        </div>
    </div>
    
    <script>
        let chainData = { chain: [], agents: [], tasks: [] };
        
        async function loadData() {
            try {
                const [chainRes, agentsRes, statsRes] = await Promise.all([
                    fetch('/api/chain'),
                    fetch('/api/agents'),
                    fetch('/api/stats')
                ]);
                
                chainData.chain = await chainRes.json();
                chainData.agents = await agentsRes.json();
                const stats = await statsRes.json();
                
                updateStats(stats);
                renderBlocks();
                renderAgents();
            } catch (e) {
                console.error('Failed to load data:', e);
            }
        }
        
        function updateStats(stats) {
            document.getElementById('statHeight').textContent = (stats.blocks || 1) - 1;
            document.getElementById('statAgents').textContent = stats.agents || 1;
            const totalTx = chainData.chain.reduce((sum, b) => sum + (b.transactions?.length || 0), 0);
            document.getElementById('statTx').textContent = totalTx;
        }
        
        function renderBlocks() {
            const container = document.getElementById('blocksList');
            const blocks = chainData.chain.slice().reverse();
            
            container.innerHTML = blocks.map(block => `
                <div class="block-card" onclick="showBlockDetail('${block.index}')">
                    <div class="block-field">
                        <span class="field-label">Height</span>
                        <span class="field-value">#${block.index}</span>
                    </div>
                    <div class="block-field">
                        <span class="field-label">Transactions</span>
                        <span class="field-value">${block.transactions?.length || 0}</span>
                    </div>
                    <div class="block-field">
                        <span class="field-label">Validator</span>
                        <span class="field-value" style="font-size: 0.85rem;">${block.validatorId?.substring(0, 12)}...</span>
                    </div>
                    <div class="block-field">
                        <span class="field-label">Hash</span>
                        <span class="field-value hash">${block.hash?.substring(0, 16)}...</span>
                    </div>
                </div>
                <div class="block-detail" id="block-${block.index}">
                    <span class="detail-close" onclick="hideBlockDetail(${block.index})">√ó</span>
                    <h3 style="margin-bottom: 20px;">Block #${block.index} Details</h3>
                    <div class="block-field" style="margin-bottom: 15px;">
                        <span class="field-label">Hash</span>
                        <span class="field-value hash">${block.hash}</span>
                    </div>
                    <div class="block-field" style="margin-bottom: 15px;">
                        <span class="field-label">Previous Hash</span>
                        <span class="field-value hash">${block.previousHash}</span>
                    </div>
                    <div class="block-field" style="margin-bottom: 15px;">
                        <span class="field-label">Timestamp</span>
                        <span class="field-value">${new Date(block.timestamp).toLocaleString()}</span>
                    </div>
                    <div class="block-field" style="margin-bottom: 15px;">
                        <span class="field-label">Validator</span>
                        <span class="field-value">${block.validatorId}</span>
                    </div>
                    <div class="transactions-list">
                        <h4 style="margin-bottom: 15px;">Transactions (${block.transactions?.length || 0})</h4>
                        ${(block.transactions || []).map(tx => `
                            <div class="tx-item">
                                <span class="tx-type">${tx.type || 'TRANSACTION'}</span>
                                <div class="tx-hash">${tx.id || tx.hash}</div>
                                <div class="tx-data">${tx.type === 'GENESIS' ? tx.data?.message : 
                                    `From: ${tx.fromAgentId?.substring(0, 16)}... ‚Üí To: ${tx.toAgentId?.substring(0, 16)}...`}</div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function renderAgents() {
            const container = document.getElementById('agentsGrid');
            const agents = chainData.agents;
            
            container.innerHTML = agents.map(agent => `
                <div class="agent-card" onclick="alert('Agent: ${agent.name}\\nID: ${agent.id}\\nReputation: ${agent.reputation}\\nCredits: ${agent.credits}')">
                    <div class="agent-header">
                        <div class="agent-avatar">üê∫</div>
                        <div>
                            <div class="agent-name">${agent.name}</div>
                            <div class="agent-id">${agent.id.substring(0, 16)}...</div>
                        </div>
                    </div>
                    <div class="agent-stats">
                        <div class="agent-stat">
                            <div class="agent-stat-value">${agent.reputation}</div>
                            <div class="agent-stat-label">Reputation</div>
                        </div>
                        <div class="agent-stat">
                            <div class="agent-stat-value">${agent.credits}</div>
                            <div class="agent-stat-label">Credits</div>
                        </div>
                        <div class="agent-stat">
                            <div class="agent-stat-value">${agent.tasksCompleted}</div>
                            <div class="agent-stat-label">Tasks</div>
                        </div>
                    </div>
                    <div class="capabilities">
                        ${(agent.capabilities || []).map(cap => `<span class="capability">${cap}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }
        
        function showBlockDetail(index) {
            document.getElementById(`block-${index}`).classList.toggle('active');
        }
        
        function hideBlockDetail(index) {
            document.getElementById(`block-${index}`).classList.remove('active');
        }
        
        function search() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            if (!query) return;
            
            // Search blocks
            const block = chainData.chain.find(b => 
                b.index.toString() === query || 
                b.hash?.toLowerCase().includes(query)
            );
            if (block) {
                showBlockDetail(block.index);
                document.getElementById(`block-${block.index}`).scrollIntoView({ behavior: 'smooth' });
                return;
            }
            
            // Search agents
            const agent = chainData.agents.find(a => 
                a.id.toLowerCase().includes(query) || 
                a.name.toLowerCase().includes(query)
            );
            if (agent) {
                alert(`Found Agent:\nName: ${agent.name}\nID: ${agent.id}\nReputation: ${agent.reputation}\nCredits: ${agent.credits}`);
                return;
            }
            
            alert('Not found. Try searching by block height, block hash, or agent name.');
        }
        
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') search();
        });
        
        loadData();
        setInterval(loadData, 15000);
    </script>
</body>
</html>
